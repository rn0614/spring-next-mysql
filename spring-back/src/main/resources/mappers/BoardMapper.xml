<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.backproject.springback.mapper.BoardMapper">
  <select id="findByBoardNumber"
    resultType="hashmap"
  > SELECT 
      board_number as boardNumber,
      title,
      content,
      write_datetime as writeDatetime,
      favorite_count as favoriteCount,
      comment_count as commentCount,
      view_count as viewCount,
      writer_email as writerEmail
    FROM board
    WHERE board_number = #{boardNumber}
  </select>
  <select id="getBoard"
    resultType="hashmap"
  > SELECT 
      B.board_number AS boardNumber,
      B.title AS title,
      B.content AS content,
      DATE_FORMAT(B.write_datetime, '%Y-%m-%d %H:%i:%s') AS writeDatetime,
      B.writer_email AS writerEmail,
      U.nickname AS writerNickname,
      U.profile_image AS writerProfileImage
    FROM board AS B
    INNER JOIN `user` AS U
    ON B.writer_email = U.email
    WHERE board_number = #{boardNumber}
  </select>

  <select id="existsByBoardNumber"
    resultType="boolean"
  > SELECT EXISTS (SELECT 1 FROM board WHERE board_number = #{boardNumber})
  </select>

  <insert id="insertBoard" parameterType="com.backproject.springback.entity.BoardEntity" useGeneratedKeys="true" keyProperty="boardNumber">
    INSERT INTO board (title, content, write_datetime, favorite_count, comment_count, view_count, writer_email)
    VALUES (#{title}, #{content}, #{writeDatetime}, #{favoriteCount}, #{commentCount}, #{viewCount}, #{writerEmail})
  </insert>

  <update id="update">
    UPDATE board
    SET title = #{title},
        content = #{content},
        favorite_count = #{favoriteCount},
        comment_count = #{commentCount},
        view_count = #{viewCount}
    WHERE board_number= #{boardNumber}
  </update>

  <update id="pathBoard" parameterType="com.backproject.springback.dto.request.board.UpdateBoardRequestDto">
    UPDATE board
    SET title = #{title},
        content = #{content}
    WHERE board_number= #{boardNumber}
  </update>

  <update id="increaseCommentCount">
    UPDATE board
    SET comment_count = comment_count+1
    WHERE board_number= #{boardNumber}
  </update>
  <update id="increaseFavoriteCount">
    UPDATE board
    SET favorite_count = favorite_count+1
    WHERE board_number= #{boardNumber}
  </update>
  <update id="decreaseFavoriteCount">
    UPDATE board
    SET favorite_count = favorite_count-1
    WHERE board_number= #{boardNumber}
    AND favorite_count > 0;
  </update>

  <update id="increaseViewCount">
    UPDATE board
    SET view_count = view_count+1
    WHERE board_number= #{boardNumber}
  </update>

  <delete id="delete">
    DELETE FROM board
    WHERE board_number= #{boardNumber}
  </delete>
  
  
</mapper>